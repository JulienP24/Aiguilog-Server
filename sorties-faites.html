<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aiguilog - Sorties faites</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* R√®gles sp√©cifiques pour cette page */
    /* (Vous pouvez int√©grer ces r√®gles dans style.css si vous le souhaitez) */
  </style>
</head>
<body>
  <header>
    <div>Aiguilog</div>
    <nav>
      <a href="sorties-faites.html" class="active">Fait</a>
      <a href="sorties-a-faire.html">√Ä Faire</a>
      <a href="#">Rechercher</a>
      <a href="utilisateur.html">üë§</a>
    </nav>
  </header>

  <div class="container">
    <h2>Sorties faites</h2>
    
    <!-- Formulaire en deux colonnes -->
    <form id="form-fait" class="two-cols">
      <!-- Colonne gauche -->
      <div class="col-left">
        <input type="text" id="sommet-fait" placeholder="Sommet" required />
        <input type="number" id="altitude-fait" placeholder="Altitude (m)" min="0" 
               onkeypress="if(event.key==='e' || event.key==='E'){event.preventDefault();}" required />
        <input type="number" id="denivele-fait" placeholder="D√©nivel√© (m)" min="0" 
               onkeypress="if(event.key==='e' || event.key==='E'){event.preventDefault();}" required />
        <textarea id="details-fait" placeholder="D√©tails"></textarea>
      </div>
      
      <!-- Colonne droite -->
      <div class="col-right">
        <select id="methode-fait" required>
          <option value="" disabled selected>M√©thode</option>
          <option value="Alpinisme">Alpinisme</option>
          <option value="Randonn√©e">Randonn√©e</option>
          <option value="Escalade">Escalade</option>
        </select>
        <!-- La liste des cotations/difficult√©s d√©pend de la m√©thode -->
        <select id="cotation-fait" required>
          <option value="" disabled selected>Cotation</option>
        </select>
        <!-- S√©lecteur d'ann√©e : liste d√©roulante g√©n√©r√©e dynamiquement -->
        <select id="year-fait" required>
          <option value="" disabled selected>Ann√©e</option>
        </select>
      </div>
      
      <!-- Bouton "Ajouter" prenant toute la largeur -->
      <div class="full-width">
        <button type="submit">Ajouter</button>
      </div>
    </form>

    <!-- Tableau d'affichage -->
    <table>
      <thead>
        <tr>
          <th>‚úèÔ∏è</th>
          <th>Sommet</th>
          <th>Altitude</th>
          <th>D√©nivel√©</th>
          <th>D√©tails</th>
          <th>M√©thode</th>
          <th>Cotation</th>
          <th>Ann√©e</th>
        </tr>
      </thead>
      <tbody id="table-body-fait"></tbody>
    </table>
  </div>

  <script>
    // Objet de correspondance M√©thode -> Cotations (ou difficult√©s)
    const cotationsParM√©thode = {
      "Alpinisme": ["F", "PD", "AD", "D", "TD", "ED"],
      "Randonn√©e": ["Facile", "Moyen", "Difficile", "Expert"],
      "Escalade": ["4a", "4b", "4c", "5a", "5b", "5c", "6a", "6b", "6c"]
    };

    const formFait = document.getElementById('form-fait');
    const methodeFait = document.getElementById('methode-fait');
    const cotationFait = document.getElementById('cotation-fait');
    const yearFait = document.getElementById('year-fait');
    const tableBodyFait = document.getElementById('table-body-fait');

    // Met √† jour la liste des cotations selon la m√©thode
    methodeFait.addEventListener('change', () => {
      const methode = methodeFait.value;
      cotationFait.innerHTML = '<option value="" disabled selected>Cotation</option>';
      if (cotationsParM√©thode[methode]) {
        cotationsParM√©thode[methode].forEach(cot => {
          const opt = document.createElement('option');
          opt.value = cot;
          opt.textContent = cot;
          cotationFait.appendChild(opt);
        });
      }
    });

    // G√©n√©ration dynamique de la liste des ann√©es √† venir (par exemple, les 10 prochaines ann√©es)
    (function populateYears() {
      const currentYear = new Date().getFullYear();
      const range = 10;
      for (let i = 0; i < range; i++) {
        const option = document.createElement('option');
        option.value = currentYear + i;
        option.textContent = currentYear + i;
        yearFait.appendChild(option);
      }
    })();

    // Formate les valeurs num√©riques avec un pr√©fixe "~" et un suffixe "m"
    function formatValue(val) {
      return val ? `~${val}m` : "";
    }

    // Fonction de basculement du mode √©dition sur une ligne du tableau
    function toggleEdit(btn) {
      const row = btn.parentElement.parentElement;
      const isEditing = row.getAttribute('data-editing') === 'true';
      // S√©lectionne toutes les cellules sauf la premi√®re (qui contient le bouton)
      const cells = row.querySelectorAll('td:not(:first-child)');

      if (!isEditing) {
        // Activation du mode √©dition
        cells.forEach(cell => {
          cell.contentEditable = "true";
          cell.classList.add("editable");
        });
        row.setAttribute('data-editing', 'true');
        btn.textContent = "‚úîÔ∏è";
      } else {
        // D√©sactivation du mode √©dition
        cells.forEach(cell => {
          cell.contentEditable = "false";
          cell.classList.remove("editable");
        });
        // Reformater les colonnes Altitude (index 2) et D√©nivel√© (index 3)
        const altitudeCell = row.children[2];
        altitudeCell.textContent = formatValue(altitudeCell.textContent.replace(/^~/, "").replace(/m$/, "").trim());
        const deniveleCell = row.children[3];
        deniveleCell.textContent = formatValue(deniveleCell.textContent.replace(/^~/, "").replace(/m$/, "").trim());

        row.setAttribute('data-editing', 'false');
        btn.textContent = "‚úèÔ∏è";
      }
    }

    // Gestion de l'ajout d'une nouvelle ligne dans le tableau
    formFait.addEventListener('submit', (e) => {
      e.preventDefault();
      const sommet = document.getElementById('sommet-fait').value.trim();
      const altitudeVal = document.getElementById('altitude-fait').value.trim();
      const deniveleVal = document.getElementById('denivele-fait').value.trim();
      const details = document.getElementById('details-fait').value.trim();
      const methode = methodeFait.value;
      const cotation = cotationFait.value;
      const annee = yearFait.value;

      // Formattage de l'altitude et du d√©nivel√©
      const altFormatted = formatValue(altitudeVal);
      const denFormatted = formatValue(deniveleVal);

      // Cr√©ation de la nouvelle ligne dans le tableau
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td><button class="edit-btn" onclick="toggleEdit(this)">‚úèÔ∏è</button></td>
        <td>${sommet}</td>
        <td>${altFormatted}</td>
        <td>${denFormatted}</td>
        <td>${details}</td>
        <td>${methode}</td>
        <td>${cotation}</td>
        <td>${annee}</td>
      `;
      tableBodyFait.appendChild(newRow);

      formFait.reset();
      cotationFait.innerHTML = '<option value="" disabled selected>Cotation</option>';
    });
  </script>
</body>
</html>
